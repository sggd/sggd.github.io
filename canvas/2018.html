<!doctype html>
<html>
  <head>
    <title>-曾与无数口井对弈-</title>
    <meta charset="utf-8">
	<link rel="icon" href="./favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="./third-party/jquery.min.js"></script>
    <script src="./third-party/two.js"></script>
    <!-- <script src='./third-party/has.js'></script> -->
  </head>
  <body style="background: #50d3c3">
<audio src="./ValderFields.mp3" autoplay="autoplay"loop="loop"></audio >
</audio>
    <div class="scripts">
      <script>
time=-1;
	              words ={
	  			  length:100,
				  words:'看樱花的时候下雨了 武昌站的摩的师傅 找七遇旅社 卿同学和昙华林的猫 湖师图书馆里自习 看橘子洲的烟花 一上午就能速成单车 所以你很聪明 two_years_ed 最温柔可爱的 最美丽善良的 还是你还是你  ',
				  p:-1,
				  word:function(){
				      if(this.p>=this.length)this.p=-1;
				      var wordStart = this.p+1;
					  while(this.words[++this.p]!=' ');
					  console.log(this.p);
					  return this.words.substring(wordStart,this.p);
					  
				  }
	              };
				  
				  wordN ={
	  			  length:85,
				  words:'Love 红包口令：零三一七 那些花儿 想长肉肉 加油 法学姑娘最可爱 当我想起你 武汉 深圳  ~感谢~ 早睡早起 很好很棒 小卿老师 长沙和你 阳光好 懒猫起床啦   ',
				  p:-1,
				  word:function(){
				      if(this.p>=this.length)this.p=-1;
				      var wordStart = this.p+1;
					  while(this.words[++this.p]!=' ');
					  console.log(this.p);
					  return this.words.substring(wordStart,this.p);
					  
				  }
	              };
				  
				 bgWords ={
	  			  length:260,
				  
				  height:15,
				  width:29,
				  words:'s9 Lovenns9曾与无数口井对弈nns8布下春天的棋局 许多街巷 nn'
					 +'s7通往植物的顶端 若骑行穿过塔楼 nns7遥望悬挂的钟表 三点以后，告别风 nn'
					 +'s8给恋人戴一顶草帽 墙壁上猫永远捉耗子 nns9涂着鸦，听着阳光咳嗽 喇叭样的花朵nn'
					 +'s9依吻栏杆斑斓的锈 生煎虎耳草 也医不了nns8云慌乱的影 拆散一个梦 爱了几年几年nn'
					 +'s7不再虚饮彼此 瓶中供养绿萝和波斯菊nns7一个叫深圳 一个叫武汉 2016 nns8Hua & MeiMei nns92018 0317nns9 把风车点完啦 nns9   有小红包',
				  p:-1,
				  word:function(i){
					  return this.words[i];
				  }
	              }; 
				  
		   type = 'canvas';
           two = new Two({
            type: Two.Types[type],
            fullscreen: true,
            autostart: true
          }).appendTo(document.body);

				  
           styles = {
            size: two.width>two.height?two.height/22:two.width/22,
            leading: 50,
            weight: 900
          };
		  
		   stylesA = {
            size: two.width>two.height?two.height/20:two.width/20,
            leading: 50,
            weight: 900
          };
		  
		  stylesTop = {
            size: two.width/10,
            leading: 50,
            weight: 900
          };
		  
 circle = two.makeCircle(-two.width/18, 0, two.width/20);
 rect = two.makeRectangle(two.width/18, 0, two.width/10, two.width/10);
circle.fill = 'rgb(50, 191, 168)';
rect.fill = 'rgb(0, 191, 118)';

 group = two.makeGroup(circle, rect);
group.translation.set(two.width / 2, two.height / 10*8.5);
group.scale = 0;
group.noStroke();			  		  
touchTime = -1;

        $(function() {


 //         var type = /(svg|webgl)/.test(url.type) ? url.type : 'canvas';


          var characters = [];
          var gravity = new Two.Vector(0, 0.55);
          var directions = two.makeText('=================', two.width / 2, two.height / 10, stylesTop);
          directions.fill = 'white';
          var directions = two.makeText('=================', two.width / 2, two.height / 10*9, stylesTop);
          directions.fill = 'white';
          $(window)
            .bind('keydown', function(e) {
              var character = String.fromCharCode(e.which);
              add(character);
            })
            .bind('touchstart', function(e) {
			  if(touchTime>=0){
              //var r = Math.random();
              //var character = String.fromCharCode(Math.floor(r*26) + (r>0.5?97:65)); 
			  if(touchTime<12){
			  touchTime++;
			  var character = words.word();
			  //alert(character);
              add(character);
              }
			  else if(touchTime==12){
			  			  touchTime++;
			  two.clear();
			  }else{
			  ////////////////////////////////////

			            var colors = [
            'rgb(0, 191, 168)',
            'rgb(153, 102, 255)',
            'rgb(255, 100, 100)',
            'rgb(0, 200, 255)'
          ];

          var background = two.makeRectangle(two.width / 2, two.height / 2, two.width, two.height);
          background.noStroke();
          background.fill = 'rgb(255, 255, 175)';
          background.name = 'background';

          var container = two.makeGroup(background);

          var rows = Math.floor(two.height / 100);
          var cols = Math.floor(two.width / 100);
          var width = Math.round(two.height / Math.max(rows, cols));

          for (var i = 0; i < rows; i++) {

            var even = !!(i % 2);
            var vi = i / (rows - 1);

            for (var j = 0; j < cols; j++) {

              var k = j;

              if (even) {
                k += 0.5;
                if (j >=  cols - 1) {
                  continue;
                }
              }

              var hi = k / (cols - 1);

              var type = !!(j % 2) ? 'Squiggle' : 'Nonagon';
              var height = !!(j % 2) ? width / 3 : width;

////////////////////////
			 var loveTxt= two.makeText(wordN.word(), width, height,stylesTop);
              var color = colors[Math.floor(Math.random() * colors.length)];
              
              loveTxt.rotation = Math.floor(Math.random() * 4) * Math.PI / 2 + Math.PI / 4;
              loveTxt.translation.set(hi * two.width, vi * two.height);

              if (j % 2) {
                loveTxt.noFill();
                loveTxt.stroke = color;
                loveTxt.linewidth = 1;
                loveTxt.cap = 'round';
              } else {
                loveTxt.noStroke();
                loveTxt.fill = color;
              }

              loveTxt.step = (Math.floor(Math.random() * 8) / 8) * Math.PI / 60;
              loveTxt.step *= Math.random() > 0.5 ? - 1 : 1;

              container.add(loveTxt);
/////////////////////////
			  
			  
			  
			  
			  
			  
            }

          }

          var cursor = two.makeCircle(0, 0, Math.min(two.height, two.width) / 3);
          cursor.outline = two.makeCircle(0, 0, Math.min(two.height, two.width) / 3);
          cursor.target = new Two.Vector();

          cursor.outline.noFill();
          cursor.outline.stroke = 'rgba(0, 100, 255, 0.1)';
          cursor.outline.linewidth = 40;

          container.mask = cursor;
          cursor.target.set(two.width / 2, two.height / 2);
          cursor.translation.copy(cursor.target);

          var center = _.debounce(function() {
            cursor.target.set(two.width / 2, two.height / 2);
          }, 1000);

          var drag = function(e) {
            cursor.target.set(e.clientX, e.clientY);
            center();
          };

          var touchDrag = function(e) {
            e.preventDefault();
            var touch = e.originalEvent.changedTouches[0];
            drag({
              clientX: touch.pageX,
              clientY: touch.pageY
            });
            return false;
          };

          $(window)
            .bind('mousemove', drag)
			.bind('touchstart',touchDrag)
            .bind('touchmove', touchDrag);

          two.bind('update', function() {

            cursor.translation.x += (cursor.target.x - cursor.translation.x) * 0.125;
            cursor.translation.y += (cursor.target.y - cursor.translation.y) * 0.125;
            //cursor.outline.translation.copy(cursor.translation);

            for (var k in container.children) {
              var child = container.children[k];
              if (child.name === 'background') {
                continue;
              }
              child.rotation += child.step;
            }

          });
			  
			  
			  
			  
			  
		        
		///////////////////////////////////////	  
			  
			  
			  
			  
			  }
			  }
            });

			


          two
            .bind('resize', function() {
              directions.translation.set(two.width / 2, two.height / 2);
            })
            .bind('update', function() {

              for (var i = 0; i < characters.length; i++) {

                var text = characters[i];
                text.translation.addSelf(text.velocity);
                text.rotation += text.velocity.r;

                text.velocity.addSelf(gravity);
                if (text.velocity.y > 0 && text.translation.y > two.height)  {
                  two.scene.remove(text);
                  characters.splice(i, 1);
                }

              }
			    				    if (group.scale > 0.9999) {
    group.scale = group.rotation = 0;
  }
  var t = (1 - group.scale) * 0.15;//0.125
  group.scale =0.6;//+= t;//+=t;
  group.rotation += t * 4 * Math.PI;//4


            });

          function add(msg) {

            var x = Math.random() * two.width / 2 + two.width / 4;
            var y = two.height * 1.25;

            var text = two.makeText(msg, x, y, stylesA);
            text.size *= 2;
            text.fill = '#333';

            text.velocity = new Two.Vector();
            text.velocity.x = 10 * (Math.random() - 0.5);
            text.velocity.y = - (20 * Math.random() + 13);
            text.velocity.r = Math.random() * Math.PI / 8;
            characters.push(text);

          };
		  



        });
		
		Two.prototype.makeSquiggle = function(width, height, phi) {

          var amt = 64;

          var squiggle = this.makeCurve(
            _.map(_.range(amt), function(i) {
              var pct = i / (amt - 1);
              var theta = pct * Math.PI * 2 * phi + Math.PI / 2;
              var x = width * pct - width / 2;
              var y = height / 2 * Math.sin(theta);
              return new Two.Anchor(x, y);
            }),
            true
          );

          return squiggle;

        };

        Two.prototype.makeNonagon = function(width, height, sides) {

          width /= 2;
          height /= 2;

          var shape = this.makePath(
            _.map(_.range(sides), function(i) {
              var pct = i / sides;
              var theta = Math.PI * 2 * pct - Math.PI / 2;
              var x = width * Math.cos(theta);
              var y = height * Math.sin(theta);
              return new Two.Anchor(x, y);
            })
          );

          return shape;

        }	  

	  		  function thebgword(){
  time++;
  var word = bgWords.word(time);
  if(word=='s'){
	time++;
	bgWords.height = bgWords.word(time);
	console.log(bgWords.height);
	time++;
	word = bgWords.word(time);
  }
  if(word=='n'){
    bgWords.width--;
	bgWords.height = 15;
	
	setTimeout('thebgword()',Math.random()*1000);//1000
  
  }

  else if(time<bgWords.length){
  /*
  if(word=='要'){
	styles.size = two.width>two.height?two.height/100:two.width/100;
	setTimeout('thebgword()',Math.random()*1);//1000
  }*/
 
    var directions=two.makeText(word, two.width /30*bgWords.width, two.height/30*(bgWords.height++), styles);
    directions.fill = '#ffd5ab';

	setTimeout('thebgword()',Math.random()*500);//500
    }else if(time>=bgWords.length){
	touchTime=0;
circle.fill = 'rgb(255,182,193)';
rect.fill = 'rgb(255,182,193)';
	}
   
};



thebgword();
	  </script>
    </div>

  </body>
</html>
